#!/bin/bash

# Sync all files from claude/ directory to ~/.claude/
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SOURCE_DIR="$SCRIPT_DIR/.."
TARGET_DIR="$HOME/.claude"

echo "Syncing files from $SOURCE_DIR to $TARGET_DIR..."

# Check if source directory exists
if [ ! -d "$SOURCE_DIR" ]; then
    echo "Error: Source directory $SOURCE_DIR not found" >&2
    exit 1
fi

# Create target directory if it doesn't exist
mkdir -p "$TARGET_DIR"

# Sync all files, preserving permissions and structure
# Exclude the bin/refresh script itself to avoid self-reference
if rsync -a --exclude='bin/refresh' "$SOURCE_DIR/" "$TARGET_DIR/"; then
    echo "Successfully synced all files to $TARGET_DIR"
else
    echo "Error: Failed to sync files to $TARGET_DIR" >&2
    exit 1
fi
